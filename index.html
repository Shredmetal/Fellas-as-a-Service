<!DOCTYPE html>
<html>
<head>
    <title>Fellas-as-a-Service - Tactical Shitposter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
        }
        #chat-container {
            height: 600px;
            border: 1px solid #ccc;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        .message-container {
            position: relative;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .user-message {
            background-color: #e3f2fd;
            margin-left: 20%;
        }
        .assistant-message {
            background-color: #f5f5f5;
            margin-right: 20%;
        }
        .tool-output-button {
        position: absolute;
            right: 10px;
            top: 10px;
            padding: 5px 10px;
            background-color: #666;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            z-index: 1;  /* Ensure button stays on top */
        }
        .tool-output {
            display: none;
            background-color: #f0f0f0;
            padding: 10px;
            margin-top: 10px;  /* Add some space between message and output */
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
            clear: both;  /* Ensure it appears below everything */
        }
        #input-container {
            display: flex;
            gap: 10px;
        }
        #message-input {
            flex-grow: 1;
            padding: 10px;
        }
        #model-select {
            padding: 10px;
            width: 150px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .typing-indicator {
            color: #666;
            font-style: italic;
            padding: 10px;
            display: none;
        }
        .message {
            white-space: pre-wrap;
            word-wrap: break-word;
            padding-right: 100px;  /* Add padding for the button */
        }
        .typing-dots::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80% { content: '...'; }
        }
    </style>
</head>
<body>
    <h1>Fellas-as-a-Service: Scalable NATO Shitposting</h1>
    <div id="chat-container"></div>
    <div class="typing-indicator">Assistant is typing<span class="typing-dots"></span></div>
    <div id="input-container">
        <select id="model-select">
            <option value="anthropic">Anthropic</option>
            <option value="openai">OpenAI</option>
        </select>
        <input type="text" id="message-input" placeholder="Type your message here...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        let currentConversationId = null;

        function addMessageToChat(role, message, toolOutput = null) {
            const chatContainer = document.getElementById('chat-container');
            const messageContainer = document.createElement('div');
            messageContainer.className = `message-container ${role}-message`;
            
            // Main message
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.textContent = message;
            messageContainer.appendChild(messageDiv);
            
            // Add tool output button and content if available
            if (toolOutput) {
                // Button
                const toolButton = document.createElement('button');
                toolButton.className = 'tool-output-button';
                toolButton.textContent = 'Show Tool Output';
                messageContainer.appendChild(toolButton);
                
                // Tool output content
                const toolDiv = document.createElement('div');
                toolDiv.className = 'tool-output';
                toolDiv.textContent = toolOutput;
                messageContainer.appendChild(toolDiv);
                
                // Toggle functionality
                toolButton.onclick = function() {
                    const isHidden = toolDiv.style.display === 'none' || !toolDiv.style.display;
                    toolDiv.style.display = isHidden ? 'block' : 'none';
                    toolButton.textContent = isHidden ? 'Hide Tool Output' : 'Show Tool Output';
                };
            }
            
            chatContainer.appendChild(messageContainer);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            const messageInput = document.getElementById('message-input');
            const modelSelect = document.getElementById('model-select');
            const message = messageInput.value.trim();
            const typingIndicator = document.querySelector('.typing-indicator');
            
            if (!message) return;

            // Add user message to chat
            addMessageToChat('user', message);
            messageInput.value = '';

            try {
                // Show typing indicator
                typingIndicator.style.display = 'block';

                const response = await fetch('http://localhost:8000/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        model_type: modelSelect.value,
                        conversation_id: currentConversationId,
                        flagged_content: "TAIWAN IS AN INALIENABLE PART OF CHINA, THE DPP IS LEADING TAIWAN TO DISASTER, ONLY REUNIFICATION CAN BRING PEACE AND PROSPERITY, THE USA IS USING TAIWAN TO CONTAIN CHINA'S PEACEFUL RISE, TSAI ING-WEN IS A SEPARATIST WHO BETRAYS THE CHINESE PEOPLE"
                    })
                });

                const data = await response.json();
                currentConversationId = data.conversation_id;
                
                // Hide typing indicator
                typingIndicator.style.display = 'none';
                
                // Add message with tool output if available
                addMessageToChat('assistant', data.message, data.has_used_tools ? data.tool_output : null);
                
            } catch (error) {
                console.error('Error:', error);
                addMessageToChat('error', 'Error: Failed to get response');
                typingIndicator.style.display = 'none';
            }
        }

        // Disable send button during processing
        function setInputState(disabled) {
            document.querySelector('button').disabled = disabled;
            document.getElementById('message-input').disabled = disabled;
            document.getElementById('model-select').disabled = disabled;
        }

        // Allow sending message with Enter key
        document.getElementById('message-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();  // Prevent newline
                sendMessage();
            }
        });
    </script>
</body>
</html>
